# 常见问题及其解决办法
> 吃果子问题记录

## 引导
**一、启动时候无限滚代码然后重启** `(10.13)`

 *10.13 内核崩溃(kernel panic)*

1. 解决重启问题：在config.plist中加入引导参数 keepSyms =1 (Keep symbols on panic) 和 debug=0x100 (Don't reboot on panic) 
```
  -v keepyms = 1 debug = 0x100
```
2. 修复内核：在KernelToPatch中添加

|  Find\*[Hex]  |   Replace\*[Hex] |   Comment  |  Match OS   |
| :-----------: |  --------------: | :--------: | :--------:  |
| b0004c8b 55f0 |   4883c440 5dc3 |   Disable panic kext logging on 10.13 Debug kernel  |  10.13   |
| 8a0284c0 7444 |   8a0284c0 eb44 |   Disable panic kext logging on 10.13 Release kernel  |  10.13   |

或者使用文本编辑器修改config.plist中的KernelToPatch
```xml
<array>
    <dict>
        <key>Comment</key>
        <string>Disable panic kext logging on 10.13 Debug kernel</string>
        <key>Disabled</key>
        <false/>
        <key>Find</key>
        <data>
        sABMi1Xw
        </data>
        <key>MatchOS</key>
        <string>10.13</string>
        <key>Replace</key>
        <data>
        SIPEQF3D
        </data>
    </dict>
    <dict>
        <key>Comment</key>
        <string>Disable panic kext logging on 10.13 Release kernel</string>
        <key>Disabled</key>
        <false/>
        <key>Find</key>
        <data>
        igKEwHRE
        </data>
        <key>MatchOS</key>
        <string>10.13</string>
        <key>Replace</key>
        <data>
        igKEwOtE
        </data>
    </dict>
</array>
```
**二、启动时候卡does printf work??** `(10.13)`

1. config.plist中去掉`slide = 0`

## 电池

**一、已拆分8位，但电池电量始终为0**

 *ACPI电池信息有误*

1. 导致这个问题的原因，可能是ACPI表中的电池信息有误，导致系统不能正常识别，需修改DSDT中的_BIF的信息。

**二、电池电量不更新** `(10.13)`

*ACPIBatteryManager.kext的bug，APFS + TRIM导致的启动过慢*

1. 不使用APFS或者在使用APFS时候，不开启固态硬盘的trim。(不推荐)
2. 使用最新版本的`ACPIBatteryManager.kext`,clover 添加启动参数 `abm_firstpolldelay=16000`,如果16000还不是行的话，改为20000。

## 显卡

**一、卡在Service only ran for 0 seconds. Pushing respawn out by 10 second** `(10.13)`

 *常见于双显卡笔记本或一体机，独显显卡无法正常启动导致，屏蔽或者分离独显即可*
 
 1. 法1：将 [SSDT-Disable-DGPU.aml](https://raw.githubusercontent.com/jardenliu/dsdt-hotpatch/master/common/SSDT-Disable-DGPU.aml) 放置在 /EFI/CLOVER/ACPI/patched 目录下。（较为通用的hotpatch，并非每一种机型都能生效）

 2. 法2：(推荐这个方法)
    1. 提取DSDT+SSDT，搜索其中显卡`_OFF`方法。将其中的scope名称替换[SSDT-DiscreteSpoof.dsl](https://github.com/jardenliu/dsdt-hotpatch/blob/master/common/SSDT-DiscreteSpoof.dsl)的`_SB.PCI0.PEG0.PEGP`。如 `_OFF`方法为`_SB_.PCI0.RP05.PXSX._OFF`，则将SSDT-DiscreteSpoof.dsl中的`_SB.PCI0.PEG0.PEGP._DSM`替换为`_SB_.PCI0.RP05.PXSX._DSM`。
    2. 使用iasl将 `SSDT-DiscreteSpoof.dsl` 编译` SSDT-DiscreteSpoof.aml`,放置在 /EFI/CLOVER/ACPI/patched 目录下。

## 硬盘

**一、硬盘I/O Error**`(10.13)`

*某些机械硬盘读取错误*


1. 在KextsToPatch中添加

|       Name    |  Find\*[Hex]  |   Replace\*[Hex] |   Comment  |  Match OS   |
| :-----------: | :-----------: |  :-------------: | :--------: | :--------:  |
| AppleAHCIPort | 4585F60F 95C289C8 83E0FE66 85C9780F 84D2750B |   89C883E0 FE6685C9 0F98C141 08CC9090 9090750B |   修复ICH10芯片 I/O Error 错误  |  10.13.x   |

或者使用文本编辑器修改config.plist中的KextsToPatch

```xml
<dict>
    <key>Comment</key>
    <string>修复ICH10芯片 I/O Error 错误</string>
    <key>Disabled</key>
    <false/>
    <key>Find</key>
   <data>RYX2D5XCiciD4P5mhcl4D4TSdQs=</data>
    <key>MatchOS</key>
    <string>10.13.x</string>
    <key>Name</key>
    <string>AppleAHCIPort</string>
    <key>Replace</key>
    <data>iciD4P5mhckPmMFBCMyQkJCQdQs=</data>
 </dict>
```

